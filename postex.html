<!DOCTYPE html>
<html lang="fa">

<head>
  <meta charset="UTF-8">
  <title>رهگیری مرسوله با شناسه سفارش — پستکس</title>
  <script src="https://developer.eitaa.com/eitaa-web-app.js"></script>
  <style>
    body {
      font-family: sans-serif;
      direction: rtl;
      padding: 20px;
      background: #f2f2f2;
    }

    h1 {
      color: #333;
    }

    label,
    input,
    button {
      display: block;
      margin: 10px 0;
      font-size: 1rem;
    }

    input {
      padding: 8px;
      width: 300px;
    }

    button {
      padding: 10px 20px;
      font-size: 1rem;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background: #0056b3;
    }

    #result {
      margin-top: 20px;
      padding: 15px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 5px;
      white-space: pre-wrap;
      font-family: monospace;
    }
  </style>
</head>

<body>

  <h1>رهگیری مرسوله با شناسه سفارش</h1>

  <div id="userName"></div>

  <label for="orderId">شناسه سفارش:</label>
  <input type="text" id="orderId" placeholder="مثلاً 123456789">
  <button onclick="trackOrder()">رهگیری</button>

  <div id="result"></div>

  <script>
    function displayUserInfo() {
      const user = window.Eitaa.WebApp.initDataUnsafe?.user;
      const userNameElement = document.getElementById('userName');

      if (user && user.first_name) {
        const userName = user.first_name;
        userNameElement.innerHTML = `Welcome ${userName}! 👋`;
      } else {
        userNameElement.innerHTML = `Welcome Guest! 👋`;
      }
    }

    async function trackOrder() {
      displayUserInfo()

      const orderId = document.getElementById('orderId').value.trim();
      const resultDiv = document.getElementById('result');

      if (!orderId) {
        resultDiv.textContent = 'لطفاً شناسه سفارش را وارد کنید.';
        return;
      }

      resultDiv.textContent = 'در حال دریافت اطلاعات...';

      try {
        const response = await fetch(
          `https://api.postex.ir/api/v1/tracking/by-order-id/${encodeURIComponent(orderId)}`,
          {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
              'x-api-key': 'postex_66b27f0c5624436FaBjNxK18x5WPLahsIvkyhepXGaXcg'
            }
          }
        );

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`خطای HTTP ${response.status}: ${errorText}`);
        }

        const data = await response.json();
        resultDiv.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        resultDiv.textContent = 'خطا در دریافت اطلاعات:\n' + err.message;
      }
    }
  </script>

</body>

</html>