<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>post tracking</title>
  <script src="https://developer.eitaa.com/eitaa-web-app.js"></script>
  <style>
    body {
      font-family: sans-serif;
      direction: rtl;
      padding: 20px;
      background: #f2f2f2;
    }

    h1 {
      color: #333;
    }

    label,
    input,
    button {
      display: block;
      margin: 10px 0;
      font-size: 1rem;
    }

    input {
      padding: 8px;
      width: 300px;
    }

    button {
      padding: 10px 20px;
      font-size: 1rem;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background: #0056b3;
    }

    #result {
      margin-top: 20px;
      padding: 15px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 5px;
      white-space: pre-wrap;
      font-family: monospace;
    }
  </style>
</head>

<body>

  <h1>track orders</h1>

  <div id="userName"></div>

  <label for="orderId">Your order id:</label>
  <input type="text" id="orderId" placeholder="Ù…Ø«Ù„Ø§Ù‹ 123456789">
  <button onclick="trackOrder()">tracking</button>

  <div id="result"></div>

  <script>
    function displayUserInfo() {
      const user = window.Eitaa.WebApp.initDataUnsafe?.user;
      const userNameElement = document.getElementById('userName');

      if (user && user.first_name) {
        const userName = user.first_name;
        userNameElement.innerHTML = `Welcome ${userName}! ğŸ‘‹`;
      } else {
        userNameElement.innerHTML = `Welcome Guest! ğŸ‘‹`;
      }
    }

    async function trackOrder() {
      displayUserInfo()

      const orderId = document.getElementById('orderId').value.trim();
      const resultDiv = document.getElementById('result');

      if (!orderId) {
        resultDiv.textContent = 'Ù„Ø·ÙØ§Ù‹ Ø´Ù†Ø§Ø³Ù‡ Ø³ÙØ§Ø±Ø´ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.';
        return;
      }

      resultDiv.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª...';

      try {
        const response = await fetch(
          `https://api.postex.ir/api/v1/tracking/by-order-id/${encodeURIComponent(orderId)}`,
          {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
              'x-api-key': 'postex_66b27f0c5624436FaBjNxK18x5WPLahsIvkyhepXGaXcg'
            }
          }
        );

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`Ø®Ø·Ø§ÛŒ HTTP ${response.status}: ${errorText}`);
        }

        const data = await response.json();
        resultDiv.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        resultDiv.textContent = 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª:\n' + err.message;
      }
    }
  </script>

</body>

</html>