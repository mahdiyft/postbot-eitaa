<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ø±Ù‡Ú¯ÛŒØ±ÛŒ Ù…Ø±Ø³ÙˆÙ„Ù‡ Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡ Ø³ÙØ§Ø±Ø´ â€” Ù¾Ø³ØªÚ©Ø³</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://developer.eitaa.com/eitaa-web-app.js"></script>
</head>
<body>

  <h1>Ø±Ù‡Ú¯ÛŒØ±ÛŒ Ù…Ø±Ø³ÙˆÙ„Ù‡ Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡ Ø³ÙØ§Ø±Ø´</h1>
  
  <div id="userName"></div>
  
  <label for="orderId">Ø´Ù†Ø§Ø³Ù‡ Ø³ÙØ§Ø±Ø´:</label>
  <input type="text" id="orderId" placeholder="Ù…Ø«Ù„Ø§Ù‹ 123456789">
  <button onclick="trackOrder()">Ø±Ù‡Ú¯ÛŒØ±ÛŒ</button>

  <div id="result"></div>

  <script>
    function displayUserInfo(){
      const user = window.Eitaa.WebApp.initDataUnsafe?.user;
      const userNameElement = document.getElementById('userName');

      if (user && user.first_name) {
        const userName = user.first_name;
        userNameElement.innerHTML = `Welcome ${userName}! ğŸ‘‹`;
      } else {
        userNameElement.innerHTML = `Welcome Guest! ğŸ‘‹`;
      }
    }

    async function trackOrder() {
      displayUserInfo()

      const orderId = document.getElementById('orderId').value.trim();
      const resultDiv = document.getElementById('result');

      if (!orderId) {
        resultDiv.textContent = 'Ù„Ø·ÙØ§Ù‹ Ø´Ù†Ø§Ø³Ù‡ Ø³ÙØ§Ø±Ø´ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.';
        return;
      }

      resultDiv.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª...';

      try {
        const response = await fetch(
          `https://api.postex.ir/api/v1/tracking/by-order-id/${encodeURIComponent(orderId)}`,
          {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
              'x-api-key': 'postex_66b27f0c5624436FaBjNxK18x5WPLahsIvkyhepXGaXcg' 
            }
          }
        );

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`Ø®Ø·Ø§ÛŒ HTTP ${response.status}: ${errorText}`);
        }

        const data = await response.json();
        resultDiv.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        resultDiv.textContent = 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª:\n' + err.message;
      }
    }
  </script>

</body>
</html>
