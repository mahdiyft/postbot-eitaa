<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>رهگیری مرسوله با شناسه سفارش — پستکس</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://developer.eitaa.com/eitaa-web-app.js"></script>
</head>
<body>

  <h1>رهگیری مرسوله با شناسه سفارش</h1>
  
  <div id="userName"></div>
  
  <label for="orderId">شناسه سفارش:</label>
  <input type="text" id="orderId" placeholder="مثلاً 123456789">
  <button onclick="trackOrder()">رهگیری</button>

  <div id="result"></div>

  <script>
    function displayUserInfo(){
      const user = window.Eitaa.WebApp.initDataUnsafe?.user;
      const userNameElement = document.getElementById('userName');

      if (user && user.first_name) {
        const userName = user.first_name;
        userNameElement.innerHTML = `Welcome ${userName}! 👋`;
      } else {
        userNameElement.innerHTML = `Welcome Guest! 👋`;
      }
    }

    async function trackOrder() {
      displayUserInfo()

      const orderId = document.getElementById('orderId').value.trim();
      const resultDiv = document.getElementById('result');

      if (!orderId) {
        resultDiv.textContent = 'لطفاً شناسه سفارش را وارد کنید.';
        return;
      }

      resultDiv.textContent = 'در حال دریافت اطلاعات...';

      try {
        const response = await fetch(
          `https://api.postex.ir/api/v1/tracking/by-order-id/${encodeURIComponent(orderId)}`,
          {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
              'x-api-key': 'postex_66b27f0c5624436FaBjNxK18x5WPLahsIvkyhepXGaXcg' 
            }
          }
        );

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`خطای HTTP ${response.status}: ${errorText}`);
        }

        const data = await response.json();
        resultDiv.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        resultDiv.textContent = 'خطا در دریافت اطلاعات:\n' + err.message;
      }
    }
  </script>

</body>
</html>
